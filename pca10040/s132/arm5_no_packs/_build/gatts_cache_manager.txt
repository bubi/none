; generated by Component: ARM Compiler 5.06 update 3 (build 300) Tool: ArmCC [4d35f0]
; commandline ArmCC [--c99 --list --split_sections --debug -c --asm --interleave -o.\_build\gatts_cache_manager.o --asm_dir=.\_build\ --list_dir=.\_build\ --depend=.\_build\gatts_cache_manager.d --cpu=Cortex-M4.fp --apcs=interwork -O0 --diag_suppress=9931 -I..\..\..\config\bluetoothds_template_pca10040_s132 -I..\..\..\config -I..\..\..\..\..\..\components -I..\..\..\..\..\..\components\ble\ble_advertising -I..\..\..\..\..\..\components\ble\ble_dtm -I..\..\..\..\..\..\components\ble\ble_racp -I..\..\..\..\..\..\components\ble\ble_services\ble_ancs_c -I..\..\..\..\..\..\components\ble\ble_services\ble_ans_c -I..\..\..\..\..\..\components\ble\ble_services\ble_bas -I..\..\..\..\..\..\components\ble\ble_services\ble_bas_c -I..\..\..\..\..\..\components\ble\ble_services\ble_cscs -I..\..\..\..\..\..\components\ble\ble_services\ble_cts_c -I..\..\..\..\..\..\components\ble\ble_services\ble_dfu -I..\..\..\..\..\..\components\ble\ble_services\ble_dis -I..\..\..\..\..\..\components\ble\ble_services\ble_gls -I..\..\..\..\..\..\components\ble\ble_services\ble_hids -I..\..\..\..\..\..\components\ble\ble_services\ble_hrs -I..\..\..\..\..\..\components\ble\ble_services\ble_hrs_c -I..\..\..\..\..\..\components\ble\ble_services\ble_hts -I..\..\..\..\..\..\components\ble\ble_services\ble_ias -I..\..\..\..\..\..\components\ble\ble_services\ble_ias_c -I..\..\..\..\..\..\components\ble\ble_services\ble_lbs -I..\..\..\..\..\..\components\ble\ble_services\ble_lbs_c -I..\..\..\..\..\..\components\ble\ble_services\ble_lls -I..\..\..\..\..\..\components\ble\ble_services\ble_nus -I..\..\..\..\..\..\components\ble\ble_services\ble_nus_c -I..\..\..\..\..\..\components\ble\ble_services\ble_rscs -I..\..\..\..\..\..\components\ble\ble_services\ble_rscs_c -I..\..\..\..\..\..\components\ble\ble_services\ble_tps -I..\..\..\..\..\..\components\ble\common -I..\..\..\..\..\..\components\ble\nrf_ble_qwr -I..\..\..\..\..\..\components\ble\peer_manager -I..\..\..\..\..\..\components\drivers_nrf\adc -I..\..\..\..\..\..\components\drivers_nrf\clock -I..\..\..\..\..\..\components\drivers_nrf\common -I..\..\..\..\..\..\components\drivers_nrf\comp -I..\..\..\..\..\..\components\drivers_nrf\delay -I..\..\..\..\..\..\components\drivers_nrf\gpiote -I..\..\..\..\..\..\components\drivers_nrf\hal -I..\..\..\..\..\..\components\drivers_nrf\i2s -I..\..\..\..\..\..\components\drivers_nrf\lpcomp -I..\..\..\..\..\..\components\drivers_nrf\pdm -I..\..\..\..\..\..\components\drivers_nrf\ppi -I..\..\..\..\..\..\components\drivers_nrf\pwm -I..\..\..\..\..\..\components\drivers_nrf\qdec -I..\..\..\..\..\..\components\drivers_nrf\rng -I..\..\..\..\..\..\components\drivers_nrf\rtc -I..\..\..\..\..\..\components\drivers_nrf\saadc -I..\..\..\..\..\..\components\drivers_nrf\spi_master -I..\..\..\..\..\..\components\drivers_nrf\spi_slave -I..\..\..\..\..\..\components\drivers_nrf\swi -I..\..\..\..\..\..\components\drivers_nrf\timer -I..\..\..\..\..\..\components\drivers_nrf\twi_master -I..\..\..\..\..\..\components\drivers_nrf\twis_slave -I..\..\..\..\..\..\components\drivers_nrf\uart -I..\..\..\..\..\..\components\drivers_nrf\wdt -I..\..\..\..\..\..\components\libraries\button -I..\..\..\..\..\..\components\libraries\crc16 -I..\..\..\..\..\..\components\libraries\crc32 -I..\..\..\..\..\..\components\libraries\csense -I..\..\..\..\..\..\components\libraries\csense_drv -I..\..\..\..\..\..\components\libraries\experimental_section_vars -I..\..\..\..\..\..\components\libraries\fds -I..\..\..\..\..\..\components\libraries\fifo -I..\..\..\..\..\..\components\libraries\fstorage -I..\..\..\..\..\..\components\libraries\hardfault -I..\..\..\..\..\..\components\libraries\hci -I..\..\..\..\..\..\components\libraries\led_softblink -I..\..\..\..\..\..\components\libraries\log -I..\..\..\..\..\..\components\libraries\log\src -I..\..\..\..\..\..\components\libraries\low_power_pwm -I..\..\..\..\..\..\components\libraries\mailbox -I..\..\..\..\..\..\components\libraries\mem_manager -I..\..\..\..\..\..\components\libraries\pwm -I..\..\..\..\..\..\components\libraries\scheduler -I..\..\..\..\..\..\components\libraries\slip -I..\..\..\..\..\..\components\libraries\timer -I..\..\..\..\..\..\components\libraries\twi -I..\..\..\..\..\..\components\libraries\uart -I..\..\..\..\..\..\components\libraries\util -I..\..\..\..\..\..\components\softdevice\common\softdevice_handler -I..\..\..\..\..\..\components\softdevice\s132\headers -I..\..\..\..\..\..\components\softdevice\s132\headers\nrf52 -I..\..\..\..\..\..\components\toolchain -I..\..\..\..\..\bsp -I..\..\..\..\..\..\external\segger_rtt -I..\config -I..\..\..\..\none -I..\..\..\..\..\..\components\drivers_ext\LS013B7DH06 -I..\..\..\..\..\..\external\ugfx -I..\..\..\..\..\..\external\ugfx\drivers\gdisp\framebuffer -I..\..\..\..\..\..\external\ugfx\src\gdisp -I..\..\..\..\..\..\external\ugfx\drivers\gdisp\ -IC:\Users\Michael\Documents\none\nRF5_SDK_12.1.0_0d23e2a\examples\ble_peripheral\none\pca10040\s132\arm5_no_packs\RTE -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\4.5.0\CMSIS\Include -IC:\Keil_v5\ARM\PACK\NordicSemiconductor\nRF_DeviceFamilyPack\8.9.0\Device\Include -D__MICROLIB -D__UVISION_VERSION=521 -D_RTE_ -DNRF52 -DBLE_STACK_SUPPORT_REQD -D__HEAP_SIZE=0 -DS132 -DNRF_SD_BLE_API_VERSION=3 -DBOARD_PCA10040 -DNRF52_PAN_12 -DNRF52_PAN_15 -DNRF52_PAN_20 -DNRF52_PAN_30 -DNRF52_PAN_31 -DNRF52_PAN_36 -DNRF52_PAN_51 -DNRF52_PAN_53 -DNRF52_PAN_54 -DNRF52_PAN_55 -DNRF52_PAN_58 -DNRF52_PAN_62 -DNRF52_PAN_63 -DNRF52_PAN_64 -DCONFIG_GPIO_AS_PINRESET -DSOFTDEVICE_PRESENT -DNRF52832 -DNRF52 -DSWI_DISABLE0 --omf_browse=.\_build\gatts_cache_manager.crf ..\..\..\..\..\..\components\ble\peer_manager\gatts_cache_manager.c]
                          THUMB

                          AREA ||i.evt_send||, CODE, READONLY, ALIGN=2

                  evt_send PROC
;;;56     
;;;57     static void evt_send(gscm_evt_t const * p_event)
000000  b570              PUSH     {r4-r6,lr}
;;;58     {
000002  4605              MOV      r5,r0
;;;59         for (uint32_t i = 0; i < GSCM_EVENT_HANDLERS_CNT; i++)
000004  2400              MOVS     r4,#0
000006  e005              B        |L1.20|
                  |L1.8|
;;;60         {
;;;61             m_evt_handler[i](p_event);
000008  4804              LDR      r0,|L1.28|
00000a  f8501024          LDR      r1,[r0,r4,LSL #2]
00000e  4628              MOV      r0,r5
000010  4788              BLX      r1
000012  1c64              ADDS     r4,r4,#1              ;59
                  |L1.20|
000014  2c00              CMP      r4,#0                 ;59
000016  d0f7              BEQ      |L1.8|
;;;62         }
;;;63     }
000018  bd70              POP      {r4-r6,pc}
;;;64     
                          ENDP

00001a  0000              DCW      0x0000
                  |L1.28|
                          DCD      m_evt_handler

                          AREA ||i.gscm_db_change_notification_done||, CODE, READONLY, ALIGN=2

                  gscm_db_change_notification_done PROC
;;;341    
;;;342    void gscm_db_change_notification_done(pm_peer_id_t peer_id)
000000  b51c              PUSH     {r2-r4,lr}
;;;343    {
000002  4604              MOV      r4,r0
;;;344        NRF_PM_DEBUG_CHECK(m_module_initialized);
;;;345    
;;;346        // Use a uint32_t to enforce 4-byte alignment.
;;;347        static const uint32_t service_changed_pending = false;
;;;348    
;;;349        //lint -save -e65 -e64
;;;350        pm_peer_data_const_t peer_data =
000004  4904              LDR      r1,|L2.24|
000006  c903              LDM      r1,{r0,r1}
000008  e9cd0100          STRD     r0,r1,[sp,#0]
;;;351        {
;;;352            .data_id                   = PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING,
;;;353            .length_words              = PM_SC_STATE_N_WORDS(),
;;;354            .p_service_changed_pending = (bool*)&service_changed_pending,
;;;355        };
;;;356        //lint -restore
;;;357    
;;;358        // Don't need to check return code, because all error conditions can be ignored.
;;;359        //lint -save -e550
;;;360        (void) pdb_raw_store(peer_id, &peer_data, NULL);
00000c  2200              MOVS     r2,#0
00000e  4669              MOV      r1,sp
000010  4620              MOV      r0,r4
000012  f7fffffe          BL       pdb_raw_store
;;;361        //lint -restore
;;;362    }
000016  bd1c              POP      {r2-r4,pc}
;;;363    #endif //PEER_MANAGER_ENABLED
                          ENDP

                  |L2.24|
                          DCD      ||.constdata||+0x10

                          AREA ||i.gscm_init||, CODE, READONLY, ALIGN=2

                  gscm_init PROC
;;;136    
;;;137    ret_code_t gscm_init()
000000  b510              PUSH     {r4,lr}
;;;138    {
;;;139        NRF_PM_DEBUG_CHECK(!m_module_initialized);
;;;140    
;;;141        internal_state_reset();
000002  f7fffffe          BL       internal_state_reset
;;;142        m_module_initialized = true;
000006  2001              MOVS     r0,#1
000008  4901              LDR      r1,|L3.16|
00000a  7008              STRB     r0,[r1,#0]
;;;143    
;;;144        return NRF_SUCCESS;
00000c  2000              MOVS     r0,#0
;;;145    }
00000e  bd10              POP      {r4,pc}
;;;146    
                          ENDP

                  |L3.16|
                          DCD      m_module_initialized

                          AREA ||i.gscm_local_database_has_changed||, CODE, READONLY, ALIGN=2

                  gscm_local_database_has_changed PROC
;;;297    
;;;298    void gscm_local_database_has_changed(void)
000000  b510              PUSH     {r4,lr}
;;;299    {
;;;300        NRF_PM_DEBUG_CHECK(m_module_initialized);
;;;301        m_current_sc_store_peer_id = pdb_next_peer_id_get(PM_PEER_ID_INVALID);
000002  f64f70ff          MOV      r0,#0xffff
000006  f7fffffe          BL       pdb_next_peer_id_get
00000a  4902              LDR      r1,|L4.20|
00000c  8008              STRH     r0,[r1,#0]
;;;302        service_changed_pending_set();
00000e  f7fffffe          BL       service_changed_pending_set
;;;303    }
000012  bd10              POP      {r4,pc}
;;;304    
                          ENDP

                  |L4.20|
                          DCD      m_current_sc_store_peer_id

                          AREA ||i.gscm_local_db_cache_apply||, CODE, READONLY, ALIGN=1

                  gscm_local_db_cache_apply PROC
;;;213    
;;;214    ret_code_t gscm_local_db_cache_apply(uint16_t conn_handle)
000000  e92d47fc          PUSH     {r2-r10,lr}
;;;215    {
000004  4681              MOV      r9,r0
;;;216        NRF_PM_DEBUG_CHECK(m_module_initialized);
;;;217    
;;;218        pm_peer_id_t         peer_id = im_peer_id_get_by_conn_handle(conn_handle);
000006  4648              MOV      r0,r9
000008  f7fffffe          BL       im_peer_id_get_by_conn_handle
00000c  4605              MOV      r5,r0
;;;219        ret_code_t           err_code;
;;;220        pm_peer_data_flash_t peer_data;
;;;221        uint8_t      const * p_sys_attr_data = NULL;
00000e  2600              MOVS     r6,#0
;;;222        uint16_t             sys_attr_len    = 0;
000010  2700              MOVS     r7,#0
;;;223        uint32_t             sys_attr_flags  = (SYS_ATTR_BOTH);
000012  f04f0803          MOV      r8,#3
;;;224        bool                 all_attributes_applied = true;
000016  f04f0a01          MOV      r10,#1
;;;225    
;;;226        if (peer_id != PM_PEER_ID_INVALID)
00001a  f64f70ff          MOV      r0,#0xffff
00001e  4285              CMP      r5,r0
000020  d00c              BEQ      |L5.60|
;;;227        {
;;;228            err_code = pdb_peer_data_ptr_get(peer_id, PM_PEER_DATA_ID_GATT_LOCAL, &peer_data);
000022  466a              MOV      r2,sp
000024  2108              MOVS     r1,#8
000026  4628              MOV      r0,r5
000028  f7fffffe          BL       pdb_peer_data_ptr_get
00002c  4604              MOV      r4,r0
;;;229            if (err_code == NRF_SUCCESS)
00002e  b92c              CBNZ     r4,|L5.60|
;;;230            {
;;;231                pm_peer_data_local_gatt_db_t const * p_local_gatt_db;
;;;232    
;;;233                p_local_gatt_db = peer_data.p_local_gatt_db;
000030  9801              LDR      r0,[sp,#4]
;;;234                p_sys_attr_data = p_local_gatt_db->data;
000032  1d86              ADDS     r6,r0,#6
;;;235                sys_attr_len    = p_local_gatt_db->len;
000034  8887              LDRH     r7,[r0,#4]
;;;236                sys_attr_flags  = p_local_gatt_db->flags;
000036  f8d08000          LDR      r8,[r0,#0]
;;;237            }
00003a  bf00              NOP      
                  |L5.60|
;;;238        }
;;;239    
;;;240        do
00003c  bf00              NOP      
                  |L5.62|
;;;241        {
;;;242            err_code = sd_ble_gatts_sys_attr_set(conn_handle, p_sys_attr_data, sys_attr_len, sys_attr_flags);
00003e  4643              MOV      r3,r8
000040  463a              MOV      r2,r7
000042  4631              MOV      r1,r6
000044  4648              MOV      r0,r9
000046  dfa9              SVC      #0xa9
000048  4604              MOV      r4,r0
;;;243    
;;;244            if (err_code == NRF_ERROR_NO_MEM)
00004a  2c04              CMP      r4,#4
00004c  d101              BNE      |L5.82|
;;;245            {
;;;246                err_code = NRF_ERROR_BUSY;
00004e  2411              MOVS     r4,#0x11
000050  e015              B        |L5.126|
                  |L5.82|
;;;247            }
;;;248            else if (err_code == NRF_ERROR_INVALID_STATE)
000052  2c08              CMP      r4,#8
000054  d101              BNE      |L5.90|
;;;249            {
;;;250                err_code = NRF_SUCCESS;
000056  2400              MOVS     r4,#0
000058  e011              B        |L5.126|
                  |L5.90|
;;;251            }
;;;252            else if (err_code == NRF_ERROR_INVALID_DATA)
00005a  2c0b              CMP      r4,#0xb
00005c  d10f              BNE      |L5.126|
;;;253            {
;;;254                all_attributes_applied = false;
00005e  f04f0a00          MOV      r10,#0
;;;255    
;;;256                if (sys_attr_flags & SYS_ATTR_USR)
000062  f0080002          AND      r0,r8,#2
000066  b110              CBZ      r0,|L5.110|
;;;257                {
;;;258                    // Try setting only system attributes.
;;;259                    sys_attr_flags = SYS_ATTR_SYS;
000068  f04f0801          MOV      r8,#1
00006c  e007              B        |L5.126|
                  |L5.110|
;;;260                }
;;;261                else if (p_sys_attr_data || sys_attr_len)
00006e  b906              CBNZ     r6,|L5.114|
000070  b127              CBZ      r7,|L5.124|
                  |L5.114|
;;;262                {
;;;263                    // Try reporting that none exist.
;;;264                    p_sys_attr_data = NULL;
000072  2600              MOVS     r6,#0
;;;265                    sys_attr_len    = 0;
000074  2700              MOVS     r7,#0
;;;266                    sys_attr_flags  = SYS_ATTR_BOTH;
000076  f04f0803          MOV      r8,#3
00007a  e000              B        |L5.126|
                  |L5.124|
;;;267                }
;;;268                else
;;;269                {
;;;270                    err_code = NRF_ERROR_INTERNAL;
00007c  2403              MOVS     r4,#3
                  |L5.126|
;;;271                }
;;;272            }
;;;273        } while (err_code == NRF_ERROR_INVALID_DATA);
00007e  2c0b              CMP      r4,#0xb
000080  d0dd              BEQ      |L5.62|
;;;274    
;;;275        if (!all_attributes_applied)
000082  f1ba0f00          CMP      r10,#0
000086  d100              BNE      |L5.138|
;;;276        {
;;;277            err_code = NRF_ERROR_INVALID_DATA;
000088  240b              MOVS     r4,#0xb
                  |L5.138|
;;;278        }
;;;279    
;;;280        return err_code;
00008a  4620              MOV      r0,r4
;;;281    }
00008c  e8bd87fc          POP      {r2-r10,pc}
;;;282    
                          ENDP


                          AREA ||i.gscm_local_db_cache_set||, CODE, READONLY, ALIGN=1

                  gscm_local_db_cache_set PROC
;;;283    
;;;284    ret_code_t gscm_local_db_cache_set(pm_peer_id_t peer_id, pm_peer_data_local_gatt_db_t * p_local_db)
000000  b57c              PUSH     {r2-r6,lr}
;;;285    {
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;286        NRF_PM_DEBUG_CHECK(m_module_initialized);
;;;287    
;;;288        pm_peer_data_const_t peer_data;
;;;289    
;;;290        memset(&peer_data, 0, sizeof(pm_peer_data_const_t));
000006  2000              MOVS     r0,#0
000008  9000              STR      r0,[sp,#0]
00000a  9001              STR      r0,[sp,#4]
;;;291        peer_data.data_id = PM_PEER_DATA_ID_GATT_LOCAL;
00000c  2008              MOVS     r0,#8
00000e  f88d0002          STRB     r0,[sp,#2]
;;;292        peer_data.p_local_gatt_db = p_local_db;
000012  9401              STR      r4,[sp,#4]
;;;293    
;;;294        return pdb_raw_store(peer_id, &peer_data, NULL);
000014  2200              MOVS     r2,#0
000016  4669              MOV      r1,sp
000018  4628              MOV      r0,r5
00001a  f7fffffe          BL       pdb_raw_store
;;;295    }
00001e  bd7c              POP      {r2-r6,pc}
;;;296    
                          ENDP


                          AREA ||i.gscm_local_db_cache_update||, CODE, READONLY, ALIGN=1

                  gscm_local_db_cache_update PROC
;;;147    
;;;148    ret_code_t gscm_local_db_cache_update(uint16_t conn_handle)
000000  e92d47fc          PUSH     {r2-r10,lr}
;;;149    {
000004  4680              MOV      r8,r0
;;;150        NRF_PM_DEBUG_CHECK(m_module_initialized);
;;;151    
;;;152        pm_peer_id_t peer_id = im_peer_id_get_by_conn_handle(conn_handle);
000006  4640              MOV      r0,r8
000008  f7fffffe          BL       im_peer_id_get_by_conn_handle
00000c  4607              MOV      r7,r0
;;;153        ret_code_t   err_code;
;;;154    
;;;155        if (peer_id == PM_PEER_ID_INVALID)
00000e  f64f70ff          MOV      r0,#0xffff
000012  4287              CMP      r7,r0
000014  d103              BNE      |L7.30|
;;;156        {
;;;157            return BLE_ERROR_INVALID_CONN_HANDLE;
000016  f2430002          MOV      r0,#0x3002
                  |L7.26|
;;;158        }
;;;159        else
;;;160        {
;;;161            pm_peer_data_t peer_data;
;;;162            uint16_t       n_bufs = 1;
;;;163            bool           retry_with_bigger_buffer = false;
;;;164    
;;;165            do
;;;166            {
;;;167                retry_with_bigger_buffer = false;
;;;168    
;;;169                err_code = pdb_write_buf_get(peer_id, PM_PEER_DATA_ID_GATT_LOCAL, n_bufs++, &peer_data);
;;;170                if (err_code == NRF_SUCCESS)
;;;171                {
;;;172                    pm_peer_data_local_gatt_db_t * p_local_gatt_db = peer_data.p_local_gatt_db;
;;;173    
;;;174                    p_local_gatt_db->flags = SYS_ATTR_BOTH;
;;;175    
;;;176                    err_code = sd_ble_gatts_sys_attr_get(conn_handle, &p_local_gatt_db->data[0], &p_local_gatt_db->len, p_local_gatt_db->flags);
;;;177    
;;;178                    if (err_code == NRF_SUCCESS)
;;;179                    {
;;;180                        err_code = pdb_write_buf_store(peer_id, PM_PEER_DATA_ID_GATT_LOCAL);
;;;181                    }
;;;182                    else
;;;183                    {
;;;184                        if (err_code == NRF_ERROR_DATA_SIZE)
;;;185                        {
;;;186                            // The sys attributes are bigger than the requested write buffer.
;;;187                            retry_with_bigger_buffer = true;
;;;188                        }
;;;189                        else if (err_code == NRF_ERROR_NOT_FOUND)
;;;190                        {
;;;191                            // There are no sys attributes in the GATT db, so nothing needs to be stored.
;;;192                            err_code = NRF_SUCCESS;
;;;193                        }
;;;194    
;;;195                        ret_code_t err_code_release = pdb_write_buf_release(peer_id, PM_PEER_DATA_ID_GATT_LOCAL);
;;;196                        if (err_code_release != NRF_SUCCESS)
;;;197                        {
;;;198                            err_code = NRF_ERROR_INTERNAL;
;;;199                        }
;;;200                    }
;;;201                }
;;;202                else if (err_code == NRF_ERROR_INVALID_PARAM)
;;;203                {
;;;204                    // The sys attributes are bigger than the entire write buffer.
;;;205                    err_code = NRF_ERROR_DATA_SIZE;
;;;206                }
;;;207            } while (retry_with_bigger_buffer);
;;;208        }
;;;209    
;;;210        return err_code;
;;;211    }
00001a  e8bd87fc          POP      {r2-r10,pc}
                  |L7.30|
00001e  f04f0901          MOV      r9,#1                 ;162
000022  f04f0a00          MOV      r10,#0                ;163
000026  bf00              NOP                            ;165
                  |L7.40|
000028  f04f0a00          MOV      r10,#0                ;167
00002c  464a              MOV      r2,r9                 ;169
00002e  1c51              ADDS     r1,r2,#1              ;169
000030  fa1ff981          UXTH     r9,r1                 ;169
000034  466b              MOV      r3,sp                 ;169
000036  2108              MOVS     r1,#8                 ;169
000038  4638              MOV      r0,r7                 ;169
00003a  f7fffffe          BL       pdb_write_buf_get
00003e  4604              MOV      r4,r0                 ;169
000040  bb04              CBNZ     r4,|L7.132|
000042  9d01              LDR      r5,[sp,#4]            ;172
000044  2003              MOVS     r0,#3                 ;174
000046  6028              STR      r0,[r5,#0]            ;174
000048  1d2a              ADDS     r2,r5,#4              ;176
00004a  1da9              ADDS     r1,r5,#6              ;176
00004c  4640              MOV      r0,r8                 ;176
00004e  682b              LDR      r3,[r5,#0]            ;176
000050  dfaa              SVC      #0xaa                 ;176
000052  4604              MOV      r4,r0                 ;176
000054  b92c              CBNZ     r4,|L7.98|
000056  2108              MOVS     r1,#8                 ;180
000058  4638              MOV      r0,r7                 ;180
00005a  f7fffffe          BL       pdb_write_buf_store
00005e  4604              MOV      r4,r0                 ;180
000060  e00f              B        |L7.130|
                  |L7.98|
000062  2c0c              CMP      r4,#0xc               ;184
000064  d102              BNE      |L7.108|
000066  f04f0a01          MOV      r10,#1                ;187
00006a  e002              B        |L7.114|
                  |L7.108|
00006c  2c05              CMP      r4,#5                 ;189
00006e  d100              BNE      |L7.114|
000070  2400              MOVS     r4,#0                 ;192
                  |L7.114|
000072  2108              MOVS     r1,#8                 ;195
000074  4638              MOV      r0,r7                 ;195
000076  f7fffffe          BL       pdb_write_buf_release
00007a  4606              MOV      r6,r0                 ;195
00007c  b106              CBZ      r6,|L7.128|
00007e  2403              MOVS     r4,#3                 ;198
                  |L7.128|
000080  bf00              NOP                            ;200
                  |L7.130|
000082  e002              B        |L7.138|
                  |L7.132|
000084  2c07              CMP      r4,#7                 ;202
000086  d100              BNE      |L7.138|
000088  240c              MOVS     r4,#0xc               ;205
                  |L7.138|
00008a  f1ba0f00          CMP      r10,#0                ;207
00008e  d1cb              BNE      |L7.40|
000090  bf00              NOP                            ;208
000092  4620              MOV      r0,r4                 ;210
000094  e7c1              B        |L7.26|
;;;212    
                          ENDP


                          AREA ||i.gscm_pdb_evt_handler||, CODE, READONLY, ALIGN=2

                  gscm_pdb_evt_handler PROC
;;;104     */
;;;105    void gscm_pdb_evt_handler(pdb_evt_t const * p_event)
000000  b57f              PUSH     {r0-r6,lr}
;;;106    {
000002  4604              MOV      r4,r0
;;;107        if (p_event->evt_id == PDB_EVT_RAW_STORED)
000004  7820              LDRB     r0,[r4,#0]
000006  2801              CMP      r0,#1
000008  d11b              BNE      |L8.66|
;;;108        {
;;;109            if (p_event->data_id == PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING)
00000a  7920              LDRB     r0,[r4,#4]
00000c  2801              CMP      r0,#1
00000e  d118              BNE      |L8.66|
;;;110            {
;;;111                ret_code_t           err_code;
;;;112                pm_peer_data_flash_t peer_data;
;;;113    
;;;114                err_code = pdb_peer_data_ptr_get(p_event->peer_id,
000010  8860              LDRH     r0,[r4,#2]
000012  aa02              ADD      r2,sp,#8
000014  2101              MOVS     r1,#1
000016  f7fffffe          BL       pdb_peer_data_ptr_get
00001a  4605              MOV      r5,r0
;;;115                                                 PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING,
;;;116                                                 &peer_data);
;;;117    
;;;118                if (err_code == NRF_SUCCESS)
00001c  b985              CBNZ     r5,|L8.64|
;;;119                {
;;;120                    gscm_evt_t gscm_evt;
;;;121                    gscm_evt.evt_id = GSCM_EVT_SC_STATE_STORED;
00001e  2002              MOVS     r0,#2
000020  f88d0000          STRB     r0,[sp,#0]
;;;122                    gscm_evt.peer_id = p_event->peer_id;
000024  8860              LDRH     r0,[r4,#2]
000026  f8ad0002          STRH     r0,[sp,#2]
;;;123                    gscm_evt.params.sc_state_stored.state = &peer_data.p_service_changed_pending;
00002a  a803              ADD      r0,sp,#0xc
00002c  b108              CBZ      r0,|L8.50|
00002e  2001              MOVS     r0,#1
000030  e000              B        |L8.52|
                  |L8.50|
000032  2000              MOVS     r0,#0
                  |L8.52|
000034  f88d0004          STRB     r0,[sp,#4]
;;;124    
;;;125                    evt_send(&gscm_evt);
000038  4668              MOV      r0,sp
00003a  f7fffffe          BL       evt_send
;;;126                }
00003e  bf00              NOP      
                  |L8.64|
;;;127            }
000040  bf00              NOP      
                  |L8.66|
;;;128        }
;;;129    
;;;130        if (m_current_sc_store_peer_id != PM_PEER_ID_INVALID)
000042  4804              LDR      r0,|L8.84|
000044  8800              LDRH     r0,[r0,#0]  ; m_current_sc_store_peer_id
000046  f64f71ff          MOV      r1,#0xffff
00004a  4288              CMP      r0,r1
00004c  d001              BEQ      |L8.82|
;;;131        {
;;;132            service_changed_pending_set();
00004e  f7fffffe          BL       service_changed_pending_set
                  |L8.82|
;;;133        }
;;;134    }
000052  bd7f              POP      {r0-r6,pc}
;;;135    
                          ENDP

                  |L8.84|
                          DCD      m_current_sc_store_peer_id

                          AREA ||i.gscm_service_changed_ind_needed||, CODE, READONLY, ALIGN=1

                  gscm_service_changed_ind_needed PROC
;;;305    
;;;306    bool gscm_service_changed_ind_needed(uint16_t conn_handle)
000000  b57c              PUSH     {r2-r6,lr}
;;;307    {
000002  4604              MOV      r4,r0
;;;308        ret_code_t err_code;
;;;309        pm_peer_data_flash_t peer_data;
;;;310        pm_peer_id_t peer_id = im_peer_id_get_by_conn_handle(conn_handle);
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       im_peer_id_get_by_conn_handle
00000a  4606              MOV      r6,r0
;;;311    
;;;312        err_code = pdb_peer_data_ptr_get(peer_id, PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING, &peer_data);
00000c  466a              MOV      r2,sp
00000e  2101              MOVS     r1,#1
000010  4630              MOV      r0,r6
000012  f7fffffe          BL       pdb_peer_data_ptr_get
000016  4605              MOV      r5,r0
;;;313    
;;;314        if (err_code != NRF_SUCCESS)
000018  b10d              CBZ      r5,|L9.30|
;;;315        {
;;;316            return false;
00001a  2000              MOVS     r0,#0
                  |L9.28|
;;;317        }
;;;318    
;;;319        return *peer_data.p_service_changed_pending;
;;;320    }
00001c  bd7c              POP      {r2-r6,pc}
                  |L9.30|
00001e  9801              LDR      r0,[sp,#4]            ;319
000020  7800              LDRB     r0,[r0,#0]            ;319
000022  e7fb              B        |L9.28|
;;;321    
                          ENDP


                          AREA ||i.gscm_service_changed_ind_send||, CODE, READONLY, ALIGN=2

                  gscm_service_changed_ind_send PROC
;;;322    
;;;323    ret_code_t gscm_service_changed_ind_send(uint16_t conn_handle)
000000  b570              PUSH     {r4-r6,lr}
;;;324    {
000002  4605              MOV      r5,r0
;;;325        static uint16_t start_handle = 0x0000;
;;;326        const  uint16_t end_handle   = 0xFFFF;
000004  f64f76ff          MOV      r6,#0xffff
;;;327        ret_code_t err_code;
;;;328    
;;;329        do
000008  bf00              NOP      
                  |L10.10|
;;;330        {
;;;331            err_code = sd_ble_gatts_service_changed(conn_handle, start_handle, end_handle);
00000a  f64f72ff          MOV      r2,#0xffff
00000e  480a              LDR      r0,|L10.56|
000010  8801              LDRH     r1,[r0,#0]  ; start_handle
000012  4628              MOV      r0,r5
000014  dfa7              SVC      #0xa7
000016  4604              MOV      r4,r0
;;;332            if (err_code == BLE_ERROR_INVALID_ATTR_HANDLE)
000018  f2430003          MOV      r0,#0x3003
00001c  4284              CMP      r4,r0
00001e  d104              BNE      |L10.42|
;;;333            {
;;;334                start_handle += 1;
000020  4805              LDR      r0,|L10.56|
000022  8800              LDRH     r0,[r0,#0]  ; start_handle
000024  1c40              ADDS     r0,r0,#1
000026  4904              LDR      r1,|L10.56|
000028  8008              STRH     r0,[r1,#0]
                  |L10.42|
;;;335            }
;;;336        } while (err_code == BLE_ERROR_INVALID_ATTR_HANDLE);
00002a  f2430003          MOV      r0,#0x3003
00002e  4284              CMP      r4,r0
000030  d0eb              BEQ      |L10.10|
;;;337    
;;;338        return err_code;
000032  4620              MOV      r0,r4
;;;339    }
000034  bd70              POP      {r4-r6,pc}
;;;340    
                          ENDP

000036  0000              DCW      0x0000
                  |L10.56|
                          DCD      start_handle

                          AREA ||i.internal_state_reset||, CODE, READONLY, ALIGN=2

                  internal_state_reset PROC
;;;49      */
;;;50     static void internal_state_reset()
000000  2000              MOVS     r0,#0
;;;51     {
;;;52         m_module_initialized       = false;
000002  4903              LDR      r1,|L11.16|
000004  7008              STRB     r0,[r1,#0]
;;;53         m_current_sc_store_peer_id = PM_PEER_ID_INVALID;
000006  f64f70ff          MOV      r0,#0xffff
00000a  4902              LDR      r1,|L11.20|
00000c  8008              STRH     r0,[r1,#0]
;;;54     }
00000e  4770              BX       lr
;;;55     
                          ENDP

                  |L11.16|
                          DCD      m_module_initialized
                  |L11.20|
                          DCD      m_current_sc_store_peer_id

                          AREA ||i.service_changed_pending_set||, CODE, READONLY, ALIGN=2

                  service_changed_pending_set PROC
;;;71      */
;;;72     static void service_changed_pending_set(void)
000000  b51c              PUSH     {r2-r4,lr}
;;;73     {
;;;74         NRF_PM_DEBUG_CHECK(m_module_initialized);
;;;75     
;;;76         ret_code_t err_code;
;;;77         // Use a uint32_t to enforce 4-byte alignment.
;;;78         static const uint32_t service_changed_pending = true;
;;;79     
;;;80         //lint -save -e65 -e64
;;;81         pm_peer_data_const_t peer_data =
000002  4911              LDR      r1,|L12.72|
000004  c903              LDM      r1,{r0,r1}
000006  e9cd0100          STRD     r0,r1,[sp,#0]
;;;82         {
;;;83             .data_id                   = PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING,
;;;84             .length_words              = PM_SC_STATE_N_WORDS(),
;;;85             .p_service_changed_pending = (bool*)&service_changed_pending,
;;;86         };
;;;87         //lint -restore
;;;88     
;;;89         err_code = pdb_raw_store(m_current_sc_store_peer_id, &peer_data, NULL);
00000a  2200              MOVS     r2,#0
00000c  4669              MOV      r1,sp
00000e  480f              LDR      r0,|L12.76|
000010  8800              LDRH     r0,[r0,#0]  ; m_current_sc_store_peer_id
000012  f7fffffe          BL       pdb_raw_store
000016  4604              MOV      r4,r0
;;;90         while ((m_current_sc_store_peer_id != PM_PEER_ID_INVALID) && (err_code != NRF_ERROR_BUSY))
000018  e00c              B        |L12.52|
                  |L12.26|
;;;91         {
;;;92             m_current_sc_store_peer_id = pdb_next_peer_id_get(m_current_sc_store_peer_id);
00001a  480c              LDR      r0,|L12.76|
00001c  8800              LDRH     r0,[r0,#0]  ; m_current_sc_store_peer_id
00001e  f7fffffe          BL       pdb_next_peer_id_get
000022  490a              LDR      r1,|L12.76|
000024  8008              STRH     r0,[r1,#0]
;;;93             err_code = pdb_raw_store(m_current_sc_store_peer_id, &peer_data, NULL);
000026  2200              MOVS     r2,#0
000028  4669              MOV      r1,sp
00002a  4808              LDR      r0,|L12.76|
00002c  8800              LDRH     r0,[r0,#0]  ; m_current_sc_store_peer_id
00002e  f7fffffe          BL       pdb_raw_store
000032  4604              MOV      r4,r0
                  |L12.52|
000034  4805              LDR      r0,|L12.76|
000036  8800              LDRH     r0,[r0,#0]            ;90  ; m_current_sc_store_peer_id
000038  f64f71ff          MOV      r1,#0xffff            ;90
00003c  4288              CMP      r0,r1                 ;90
00003e  d001              BEQ      |L12.68|
000040  2c11              CMP      r4,#0x11              ;90
000042  d1ea              BNE      |L12.26|
                  |L12.68|
;;;94         }
;;;95     }
000044  bd1c              POP      {r2-r4,pc}
;;;96     //lint -restore
                          ENDP

000046  0000              DCW      0x0000
                  |L12.72|
                          DCD      ||.constdata||+0x4
                  |L12.76|
                          DCD      m_current_sc_store_peer_id

                          AREA ||.constdata||, DATA, READONLY, ALIGN=2

                  service_changed_pending
                          DCD      0x00000001
000004  0001              DCW      0x0001
000006  0100              DCB      0x01,0x00
                          DCD      service_changed_pending
                  |symbol_number.38|
                          DCD      0x00000000
000010  0001              DCW      0x0001
000012  0100              DCB      0x01,0x00
                          DCD      |symbol_number.38|

                          AREA ||.data||, DATA, ALIGN=2

                  m_evt_handler
                          DCD      gcm_gscm_evt_handler
                  m_module_initialized
000004  0000              DCB      0x00,0x00
                  m_current_sc_store_peer_id
000006  0000              DCB      0x00,0x00
                  start_handle
000008  0000              DCW      0x0000

;*** Start embedded assembler ***

#line 1 "..\\..\\..\\..\\..\\..\\components\\ble\\peer_manager\\gatts_cache_manager.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___21_gatts_cache_manager_c_76a3a2bf____REV16|
#line 388 "C:\\Keil_v5\\ARM\\PACK\\ARM\\CMSIS\\4.5.0\\CMSIS\\Include\\cmsis_armcc.h"
|__asm___21_gatts_cache_manager_c_76a3a2bf____REV16| PROC
#line 389

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___21_gatts_cache_manager_c_76a3a2bf____REVSH|
#line 402
|__asm___21_gatts_cache_manager_c_76a3a2bf____REVSH| PROC
#line 403

 revsh r0, r0
 bx lr
	ENDP
	AREA ||.rrx_text||, CODE
	THUMB
	EXPORT |__asm___21_gatts_cache_manager_c_76a3a2bf____RRX|
#line 587
|__asm___21_gatts_cache_manager_c_76a3a2bf____RRX| PROC
#line 588

 rrx r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
